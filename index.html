<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daily Deal Pro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- THEME & CORE --- */
        body {
            background-color: #0b1121; /* Darker Slate */
            color: #f8fafc;
            font-family: 'Hind Siliguri', 'Segoe UI', sans-serif;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            min-height: 100vh;
            user-select: none;
            padding-bottom: 90px;
        }

        /* Glassmorphism Panel */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        /* Bottom Navigation */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex; justify-content: space-around;
            padding: 12px 0 25px 0; z-index: 50;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            font-size: 10px; color: #64748b; width: 20%; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .nav-item.active { color: #38bdf8; transform: translateY(-4px); }
        .nav-item.active i { filter: drop-shadow(0 0 8px #38bdf8); }
        .nav-item i { font-size: 20px; margin-bottom: 4px; transition: 0.3s; }

        /* Page Transitions */
        .page-section { display: none; padding: 0 20px; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .page-section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Spin Wheel Styles */
        .wheel-container {
            position: relative; width: 280px; height: 280px; margin: 0 auto;
            border-radius: 50%; border: 4px solid #334155;
            overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }
        .wheel-section {
            position: absolute; width: 50%; height: 50%; top: 50%; left: 50%;
            transform-origin: 0% 0%; clip-path: polygon(0 0, 100% 0, 100% 100%);
        }
        .wheel-pointer {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 30px; height: 40px; background: #ef4444; z-index: 20;
            clip-path: polygon(50% 100%, 0 0, 100% 0); filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
        }
        .wheel-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 40px; height: 40px; background: #fff; border-radius: 50%; z-index: 10;
            box-shadow: 0 0 10px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
        }

        /* Leaderboard List */
        .rank-item:nth-child(1) .rank-num { color: #fbbf24; text-shadow: 0 0 10px #fbbf24; } /* Gold */
        .rank-item:nth-child(2) .rank-num { color: #94a3b8; text-shadow: 0 0 10px #94a3b8; } /* Silver */
        .rank-item:nth-child(3) .rank-num { color: #b45309; text-shadow: 0 0 10px #b45309; } /* Bronze */

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body>

    <!-- Ban Overlay -->
    <div id="ban-overlay" class="hidden fixed inset-0 bg-slate-900/95 z-[100] flex flex-col justify-center items-center p-8 text-center backdrop-blur-sm">
        <div class="glass-panel p-8 w-full max-w-sm border-red-500/30">
            <i class="fas fa-ban text-5xl text-red-500 mb-4 animate-bounce"></i>
            <h2 class="text-2xl font-bold text-white mb-2">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï‡¶°</h2>
            <p class="text-slate-400 text-sm mb-6">Security policy violation detected.</p>
            <a href="#" id="ban-contact-btn" class="inline-block w-full bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-xl font-bold transition">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</a>
        </div>
    </div>

    <!-- Header -->
    <div class="px-5 pt-6 pb-2 sticky top-0 bg-[#0b1121]/90 backdrop-blur-md z-40">
        <div class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-3">
                <div class="w-11 h-11 rounded-full p-[2px] bg-gradient-to-tr from-blue-500 to-purple-500">
                    <img id="user-photo" src="https://via.placeholder.com/150" class="w-full h-full rounded-full object-cover border-2 border-[#0b1121]">
                </div>
                <div>
                    <div class="flex items-center gap-2">
                        <h3 class="font-bold text-base text-white truncate max-w-[120px]" id="username">Guest</h3>
                        <span id="user-badge" class="text-[9px] px-2 py-0.5 rounded-full bg-slate-700 text-slate-300 font-bold tracking-wider">NEWBIE</span>
                    </div>
                    <p class="text-[10px] text-slate-400">UID: <span id="uid-header">...</span></p>
                </div>
            </div>
            <div class="glass-panel px-4 py-2 flex items-center gap-2 border-yellow-500/20 bg-yellow-500/5">
                <i class="fas fa-coins text-yellow-400 drop-shadow-md"></i>
                <span class="font-bold text-lg text-white" id="balance">0.00</span>
            </div>
        </div>
    </div>

    <div id="app-content" class="mt-2">

        <!-- HOME SECTION -->
        <div id="home" class="page-section active">
            
            <!-- Daily Bonus Card -->
            <div class="glass-panel p-5 mb-5 relative overflow-hidden group">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20 opacity-0 group-hover:opacity-100 transition duration-500"></div>
                <div class="flex justify-between items-start z-10 relative">
                    <div>
                        <h3 class="text-lg font-bold text-white flex items-center gap-2"><i class="fas fa-calendar-check text-blue-400"></i> ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶ö‡ßá‡¶ï-‡¶á‡¶®</h3>
                        <p class="text-slate-400 text-xs mb-3">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®</p>
                    </div>
                    <div class="bg-blue-500/20 p-2.5 rounded-xl border border-blue-500/30">
                        <i class="fas fa-gift text-2xl text-blue-400 animate-pulse"></i>
                    </div>
                </div>
                
                <button id="btn-daily-bonus" onclick="claimDailyBonus()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-900/50 transition active:scale-95 text-sm relative z-10">
                    ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶® (+<span id="daily-amount-display">0</span>)
                </button>
                
                <div id="bonus-timer-box" class="hidden w-full bg-slate-800/80 text-slate-300 py-3 rounded-xl font-bold text-center border border-slate-700 text-sm">
                    ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: <span id="bonus-countdown" class="text-blue-400 font-mono ml-1">00:00:00</span>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="glass-panel p-3 flex flex-col items-center justify-center gap-1 hover:bg-slate-800/50 transition">
                    <div class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center mb-1">
                        <i class="fas fa-wallet text-green-400 text-sm"></i>
                    </div>
                    <div class="text-[10px] text-slate-400 uppercase tracking-wide">Total Earn</div>
                    <div class="font-bold text-base" id="stat-income">0</div>
                </div>
                <div class="glass-panel p-3 flex flex-col items-center justify-center gap-1 hover:bg-slate-800/50 transition">
                    <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center mb-1">
                        <i class="fas fa-users text-purple-400 text-sm"></i>
                    </div>
                    <div class="text-[10px] text-slate-400 uppercase tracking-wide">Referrals</div>
                    <div class="font-bold text-base" id="stat-refer">0</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="switchTab('spin')" class="glass-panel p-4 flex items-center justify-between group active:scale-95 transition bg-gradient-to-br from-pink-500/10 to-rose-500/10 border-rose-500/30">
                    <div class="text-left">
                        <div class="text-rose-400 font-bold text-sm">‡¶≤‡¶æ‡¶ï‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶®</div>
                        <div class="text-[10px] text-slate-400">‡¶ö‡¶æ‡¶ï‡¶æ ‡¶ò‡ßÅ‡¶∞‡¶ø‡ßü‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</div>
                    </div>
                    <i class="fas fa-dice text-2xl text-rose-500 group-hover:rotate-12 transition"></i>
                </button>
                <button onclick="openLeaderboard()" class="glass-panel p-4 flex items-center justify-between group active:scale-95 transition bg-gradient-to-br from-yellow-500/10 to-orange-500/10 border-yellow-500/30">
                    <div class="text-left">
                        <div class="text-yellow-400 font-bold text-sm">‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°</div>
                        <div class="text-[10px] text-slate-400">‡¶ü‡¶™ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</div>
                    </div>
                    <i class="fas fa-trophy text-2xl text-yellow-500 group-hover:scale-110 transition"></i>
                </button>
            </div>

            <!-- Recent Task Header -->
             <div class="flex justify-between items-end mb-3 px-1">
                <h3 class="font-bold text-slate-300 text-sm">‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h3>
                <span onclick="switchTab('tasks')" class="text-[10px] text-blue-400 cursor-pointer">‡¶∏‡¶¨ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® <i class="fas fa-arrow-right"></i></span>
            </div>
            
            <!-- Mini Task Preview -->
            <div class="glass-panel p-4 flex justify-between items-center mb-20 border-l-4 border-l-blue-500">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-600 text-white w-10 h-10 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/30">
                        <i class="fas fa-ad"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm text-white">Watch Ads</h4>
                        <p class="text-[10px] text-slate-400">Earn unlimited points</p>
                    </div>
                </div>
                <button onclick="switchTab('tasks')" class="px-4 py-1.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs font-bold transition">Go</button>
            </div>
        </div>

        <!-- SPIN WHEEL SECTION -->
        <div id="spin" class="page-section">
            <h2 class="text-center text-xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-rose-400 to-orange-400">‡¶≤‡¶æ‡¶ï‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶π‡ßÅ‡¶á‡¶≤</h2>
            
            <div class="relative py-4 mb-6">
                <div class="wheel-pointer"></div>
                <div class="wheel-container" id="wheel">
                    <!-- Wheel Segments generated by JS -->
                </div>
                <div class="wheel-center">
                    <i class="fas fa-star text-yellow-500 text-xs"></i>
                </div>
            </div>

            <button id="spin-btn" onclick="spinWheel()" class="w-full max-w-[200px] mx-auto block bg-gradient-to-r from-rose-600 to-orange-600 hover:from-rose-500 hover:to-orange-500 text-white py-3 rounded-full font-bold shadow-lg shadow-orange-900/50 transition active:scale-95 text-lg disabled:opacity-50 disabled:cursor-not-allowed">
                SPIN NOW
            </button>
            <p class="text-center text-xs text-slate-400 mt-4">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶® ‡¶´‡ßç‡¶∞‡¶ø! (‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü: <span id="spin-limit">0/10</span>)</p>
        </div>

        <!-- TASKS SECTION -->
        <div id="tasks" class="page-section">
            <div class="bg-blue-500/10 border border-blue-500/20 p-4 rounded-xl mb-5 flex gap-3 items-start">
                <i class="fas fa-info-circle text-blue-400 mt-0.5"></i>
                <p class="text-[11px] text-blue-100 leading-relaxed">
                    ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®‡•§ ‡¶®‡¶ø‡ßü‡¶Æ ‡¶®‡¶æ ‡¶Æ‡¶æ‡¶®‡¶≤‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§
                </p>
            </div>

            <div class="space-y-4 pb-20">
                <!-- Ad Networks -->
                <div class="glass-panel p-4 flex justify-between items-center group hover:border-blue-500/50 transition">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-cyan-600 flex items-center justify-center text-white shadow-lg">
                            <i class="fas fa-globe text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-sm text-white group-hover:text-blue-400 transition">Premium Web Ad</h4>
                            <p class="text-[10px] text-slate-400">‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü: <span id="limit-net1">0/5</span></p>
                        </div>
                    </div>
                    <button onclick="watchAd('net1')" class="bg-slate-700 hover:bg-blue-600 text-white px-5 py-2 rounded-lg text-xs font-bold transition active:scale-95 border border-slate-600">
                        +<span id="reward-net1">0</span>
                    </button>
                </div>

                <div class="glass-panel p-4 flex justify-between items-center group hover:border-purple-500/50 transition">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center text-white shadow-lg">
                            <i class="fas fa-play text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-sm text-white group-hover:text-purple-400 transition">Video Ad Zone</h4>
                            <p class="text-[10px] text-slate-400">‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü: <span id="limit-net2">0/5</span></p>
                        </div>
                    </div>
                    <button onclick="watchAd('net2')" class="bg-slate-700 hover:bg-purple-600 text-white px-5 py-2 rounded-lg text-xs font-bold transition active:scale-95 border border-slate-600">
                        +<span id="reward-net2">0</span>
                    </button>
                </div>

                <!-- External Tasks Loader -->
                <h3 class="font-bold text-slate-500 text-xs uppercase tracking-wider mt-6 mb-2 pl-1">‡¶è‡¶ï‡ßç‡¶∏‡¶ü‡ßç‡¶∞‡¶æ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h3>
                <div id="task-list-container" class="space-y-3">
                    <div class="animate-pulse flex space-x-4 glass-panel p-4">
                        <div class="rounded-full bg-slate-700 h-10 w-10"></div>
                        <div class="flex-1 space-y-2 py-1">
                            <div class="h-2 bg-slate-700 rounded"></div>
                            <div class="h-2 bg-slate-700 rounded w-3/4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- WALLET SECTION -->
        <div id="wallet" class="page-section">
            <div class="relative bg-gradient-to-br from-indigo-600 to-blue-700 rounded-2xl p-6 text-center shadow-xl shadow-indigo-900/40 mb-8 overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full blur-2xl transform translate-x-10 -translate-y-10"></div>
                <div class="relative z-10">
                    <p class="text-indigo-200 text-xs font-medium uppercase tracking-widest mb-1">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                    <h1 class="text-4xl font-bold text-white mb-3 font-mono tracking-tight">‡ß≥ <span id="wallet-balance">0.00</span></h1>
                    <div class="inline-block bg-black/20 backdrop-blur-md px-3 py-1 rounded-lg border border-white/10">
                        <p class="text-[10px] text-white">‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞: <span id="min-withdraw-display" class="font-bold text-yellow-300">0</span> ‡¶ï‡ßü‡ßá‡¶®</p>
                    </div>
                </div>
            </div>

            <!-- Tab Switcher for Wallet -->
            <div class="flex p-1 bg-slate-800 rounded-xl mb-6">
                <button onclick="showWalletTab('withdraw')" id="tab-withdraw" class="flex-1 py-2 rounded-lg text-xs font-bold text-white bg-slate-700 shadow transition">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</button>
                <button onclick="showWalletTab('history')" id="tab-history" class="flex-1 py-2 rounded-lg text-xs font-bold text-slate-400 hover:text-white transition">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</button>
            </div>

            <!-- Withdraw Form -->
            <div id="wallet-withdraw-view">
                <h3 class="font-bold mb-3 text-xs text-slate-400 uppercase pl-1">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div id="payment-methods-grid" class="grid grid-cols-2 gap-3 mb-6">
                    <!-- JS Injected -->
                </div>

                <div class="space-y-4">
                    <div class="relative group">
                        <i class="fas fa-phone absolute left-4 top-4 text-slate-500 group-focus-within:text-blue-500 transition"></i>
                        <input type="number" id="wd-number" placeholder="‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full bg-[#1e293b] border border-slate-700 rounded-xl py-3.5 pl-10 pr-4 text-white text-sm focus:outline-none focus:border-blue-500 focus:bg-slate-800 transition">
                    </div>
                    <div class="relative group">
                        <i class="fas fa-coins absolute left-4 top-4 text-slate-500 group-focus-within:text-blue-500 transition"></i>
                        <input type="number" id="wd-amount" placeholder="‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü (‡¶ï‡ßü‡ßá‡¶®)" class="w-full bg-[#1e293b] border border-slate-700 rounded-xl py-3.5 pl-10 pr-4 text-white text-sm focus:outline-none focus:border-blue-500 focus:bg-slate-800 transition">
                    </div>
                    <button onclick="requestWithdraw()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-900/30 mt-2 active:scale-95 transition flex items-center justify-center gap-2">
                        <i class="fas fa-paper-plane"></i> ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü
                    </button>
                </div>
            </div>

            <!-- History View -->
            <div id="wallet-history-view" class="hidden">
                <div id="history-list" class="space-y-3 pb-20">
                    <p class="text-center text-xs text-slate-500 py-10">‡¶ï‡ßã‡¶®‡ßã ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>
                </div>
            </div>
        </div>

        <!-- PROFILE SECTION -->
        <div id="profile" class="page-section">
            <div class="glass-panel p-6 flex flex-col items-center mb-6 border-t-4 border-t-blue-500">
                <div class="relative w-24 h-24 mb-4">
                    <img id="profile-img-big" src="" class="w-full h-full object-cover rounded-full border-4 border-slate-700 shadow-lg">
                    <div class="absolute bottom-0 right-0 w-6 h-6 bg-green-500 rounded-full border-4 border-slate-800"></div>
                </div>
                <h2 class="text-xl font-bold text-white mb-1" id="profile-name">...</h2>
                <div class="flex gap-2 mb-4">
                    <span id="profile-badge-lg" class="px-3 py-1 bg-blue-500/10 text-blue-400 text-[10px] font-bold rounded-full border border-blue-500/20">NEWBIE</span>
                    <span class="px-3 py-1 bg-green-500/10 text-green-400 text-[10px] font-bold rounded-full border border-green-500/20">VERIFIED</span>
                </div>
                
                <div class="grid grid-cols-2 gap-4 w-full mt-2">
                    <div class="bg-slate-900/50 p-3 rounded-lg text-center">
                        <div class="text-[10px] text-slate-400">‡¶ú‡ßü‡ßá‡¶®‡¶ø‡¶Ç ‡¶°‡ßá‡¶ü</div>
                        <div class="text-xs font-bold text-slate-200" id="join-date">Loading...</div>
                    </div>
                    <div class="bg-slate-900/50 p-3 rounded-lg text-center">
                        <div class="text-[10px] text-slate-400">‡¶ü‡ßã‡¶ü‡¶æ‡¶≤ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</div>
                        <div class="text-xs font-bold text-slate-200" id="total-earn-profile">0</div>
                    </div>
                </div>
            </div>

            <div class="glass-panel p-5 mb-4 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-6xl text-indigo-500/10"><i class="fas fa-share-alt"></i></div>
                <h4 class="font-bold text-sm text-white mb-2">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                <p class="text-xs text-slate-400 mb-4">‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶á‡¶®‡¶≠‡¶æ‡¶á‡¶ü ‡¶ï‡¶∞‡ßá ‡¶≤‡¶æ‡¶á‡¶´‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ï‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ú‡¶ø‡¶§‡ßá ‡¶®‡¶ø‡¶®‡•§</p>
                
                <div class="flex gap-2">
                    <div class="bg-slate-900 border border-slate-700 text-slate-400 text-xs p-3 rounded-lg flex-1 truncate font-mono select-all" id="ref-link-text">...</div>
                    <button onclick="copyReferral()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 rounded-lg transition active:scale-95"><i class="fas fa-copy"></i></button>
                </div>
                <button onclick="shareReferral()" class="w-full mt-3 bg-slate-700 hover:bg-slate-600 text-white py-2.5 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition">
                    <i class="fab fa-telegram-plane"></i> ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
            </div>

            <button onclick="openSupport()" class="w-full glass-panel p-4 flex items-center justify-between hover:bg-slate-800 transition mb-20">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-pink-500/20 flex items-center justify-center text-pink-400"><i class="fas fa-headset"></i></div>
                    <span class="text-sm font-bold text-slate-200">‡¶π‡ßá‡¶≤‡ßç‡¶™ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</span>
                </div>
                <i class="fas fa-chevron-right text-slate-500 text-xs"></i>
            </button>
        </div>

    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="fixed inset-0 bg-black/80 z-[60] hidden flex-col justify-end sm:justify-center transition-opacity duration-300 backdrop-blur-sm">
        <div class="bg-[#1e293b] w-full sm:max-w-md mx-auto sm:rounded-2xl rounded-t-2xl p-5 h-[80vh] flex flex-col animate-slideUp">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-bold text-white flex items-center gap-2"><i class="fas fa-trophy text-yellow-500"></i> ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
                <button onclick="closeLeaderboard()" class="w-8 h-8 bg-slate-800 rounded-full text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto custom-scroll space-y-3" id="leaderboard-list">
                <!-- Rows -->
            </div>
            <div class="mt-4 pt-4 border-t border-slate-700 text-center text-xs text-slate-500">
                Top 10 Earners
            </div>
        </div>
    </div>

    <!-- Nav Bar -->
    <div class="nav-bar">
        <div class="nav-item active" onclick="switchTab('home')"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="nav-item" onclick="switchTab('spin')"><i class="fas fa-dharmachakra"></i><span>Spin</span></div>
        <div class="nav-item" onclick="switchTab('tasks')"><i class="fas fa-tasks"></i><span>Tasks</span></div>
        <div class="nav-item" onclick="switchTab('wallet')"><i class="fas fa-wallet"></i><span>Wallet</span></div>
        <div class="nav-item" onclick="switchTab('profile')"><i class="fas fa-user-circle"></i><span>Profile</span></div>
    </div>

    <script type="module">
        // --- CONFIGURATION ---
        const BOT_USERNAME = "YourBotUsername"; 
        const APP_SHORT_NAME = "dailydeal"; 

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, doc, setDoc, getDoc, updateDoc, 
            onSnapshot, collection, increment, addDoc, serverTimestamp, 
            query, orderBy, limit, where 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // !!! REPLACE WITH YOUR FIREBASE CONFIG !!!
        const firebaseConfig = {
          apiKey: "AIzaSyAqFUJ41ol_IGO1Qq1nC3ItLBgi_GGduxE",
          authDomain: "daily-deal-dfdaa.firebaseapp.com",
          projectId: "daily-deal-dfdaa",
          storageBucket: "daily-deal-dfdaa.firebasestorage.app",
          messagingSenderId: "1002150750060",
          appId: "1:1002150750060:web:f7c5208dd2ce6cb3953549"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // State
        let currentUser = null;
        let dbUser = null;
        let settings = { 
            dailyBonus: 50, minWithdraw: 5000, 
            supportLink: "https://t.me/support", 
            monetagZoneId: "10312256", 
            announcement: "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!",
            referralBonus: 100,
            spinDailyLimit: 10
        };
        let adSettings = { net1: {limit: 5, reward: 10}, net2: {limit: 5, reward: 10} };
        let selectedPayMethod = null;
        let spinning = false;

        // --- INIT ---
        window.addEventListener('load', async () => {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready(); tg.expand();
                tg.setHeaderColor('#0b1121'); tg.setBackgroundColor('#0b1121');
                currentUser = tg.initDataUnsafe.user;
            }
            if (!currentUser) currentUser = { id: 'user_dev_02', first_name: 'Dev', last_name: 'Tester', photo_url: 'https://via.placeholder.com/150' };

            updateProfileUI();
            initSpinWheel();
            await initFirebase();
            setInterval(checkDailyBonusTimer, 1000);
        });

        function updateProfileUI() {
            document.getElementById('username').innerText = currentUser.first_name;
            document.getElementById('profile-name').innerText = currentUser.first_name + ' ' + (currentUser.last_name || '');
            document.getElementById('uid-header').innerText = currentUser.id;
            const refLink = `https://t.me/${BOT_USERNAME}/${APP_SHORT_NAME}?startapp=ref_${currentUser.id}`;
            document.getElementById('ref-link-text').innerText = refLink;
            if(currentUser.photo_url) {
                document.getElementById('user-photo').src = currentUser.photo_url;
                document.getElementById('profile-img-big').src = currentUser.photo_url;
            }
        }

        async function initFirebase() {
            await signInAnonymously(auth);
            const uid = currentUser.id.toString();

            // Config
            onSnapshot(doc(db, "settings", "config"), (s) => {
                if (s.exists()) {
                    settings = { ...settings, ...s.data() };
                    adSettings = settings.ads || adSettings;
                    renderPaymentMethods();
                    updateAdUI();
                    loadMonetagScript(settings.monetagZoneId);
                }
            });

            // User Data
            onSnapshot(doc(db, "users", uid), async (docSnap) => {
                if (docSnap.exists()) {
                    dbUser = docSnap.data();
                    handleSecuritySystem();
                    updateUI(dbUser);
                } else {
                    await createNewUser(uid);
                }
            });

            loadTasks();
        }

        async function createNewUser(uid) {
            let referredBy = null;
            let startParam = window.Telegram.WebApp.initDataUnsafe.start_param;
            if (startParam && startParam.startsWith('ref_')) {
                let refId = startParam.replace('ref_', '');
                if (refId !== uid) referredBy = refId;
            }

            const newUser = {
                id: currentUser.id, firstName: currentUser.first_name,
                balance: 50, totalIncome: 50, totalWithdraw: 0,
                banned: false, strikes: 0,
                referredBy: referredBy, referrals: 0,
                createdAt: serverTimestamp(),
                adCounts: { net1: 0, net2: 0, spin: 0, date: new Date().toDateString() },
                lastBonusTime: 0
            };

            await setDoc(doc(db, "users", uid), newUser);
            if (referredBy) {
                try {
                    await updateDoc(doc(db, "users", referredBy), {
                        balance: increment(settings.referralBonus),
                        referrals: increment(1)
                    });
                } catch(e){}
            }
        }

        // --- UI UPDATES ---
        function updateUI(u) {
            document.getElementById('balance').innerText = u.balance.toFixed(0);
            document.getElementById('wallet-balance').innerText = u.balance.toFixed(2);
            document.getElementById('stat-income').innerText = u.totalIncome.toFixed(0);
            document.getElementById('stat-refer').innerText = u.referrals || 0;
            document.getElementById('total-earn-profile').innerText = u.totalIncome.toFixed(0);
            
            // Badge Logic
            let badge = "NEWBIE";
            let color = "text-slate-300 bg-slate-700";
            if(u.totalIncome > 5000) { badge = "PRO"; color = "text-blue-200 bg-blue-900"; }
            if(u.totalIncome > 20000) { badge = "LEGEND"; color = "text-yellow-200 bg-yellow-900"; }
            
            document.getElementById('user-badge').innerText = badge;
            document.getElementById('user-badge').className = `text-[9px] px-2 py-0.5 rounded-full font-bold tracking-wider ${color}`;
            document.getElementById('profile-badge-lg').innerText = badge;

            if(u.createdAt) {
                const date = u.createdAt.toDate ? u.createdAt.toDate() : new Date();
                document.getElementById('join-date').innerText = date.toLocaleDateString();
            }

            updateAdUI();
        }

        function updateAdUI() {
            if(!dbUser) return;
            const today = new Date().toDateString();
            let counts = dbUser.adCounts || {};
            if(counts.date !== today) counts = { net1: 0, net2: 0, spin: 0, date: today };
            
            // Ad Limits
            document.getElementById('limit-net1').innerText = `${counts.net1}/${adSettings.net1?.limit || 5}`;
            document.getElementById('reward-net1').innerText = adSettings.net1?.reward || 0;
            document.getElementById('limit-net2').innerText = `${counts.net2}/${adSettings.net2?.limit || 5}`;
            document.getElementById('reward-net2').innerText = adSettings.net2?.reward || 0;
            
            // Spin Limit
            document.getElementById('spin-limit').innerText = `${counts.spin || 0}/${settings.spinDailyLimit || 10}`;
            
            document.getElementById('daily-amount-display').innerText = settings.dailyBonus;
            document.getElementById('min-withdraw-display').innerText = settings.minWithdraw;
        }

        // --- SPIN WHEEL LOGIC ---
        const spinRewards = [0, 5, 10, 15, 20, 30, 50, 0];
        const spinColors = ['#ef4444', '#f97316', '#f59e0b', '#84cc16', '#10b981', '#06b6d4', '#8b5cf6', '#64748b'];

        function initSpinWheel() {
            const wheel = document.getElementById('wheel');
            const segmentAngle = 360 / spinRewards.length;
            
            spinRewards.forEach((reward, i) => {
                const el = document.createElement('div');
                el.className = 'wheel-section';
                el.style.backgroundColor = spinColors[i];
                el.style.transform = `rotate(${i * segmentAngle}deg) skewY(-${90 - segmentAngle}deg)`;
                
                // Content centering hack
                const content = document.createElement('div');
                content.innerText = reward;
                content.style.cssText = `position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%) rotate(22.5deg) translate(80px) rotate(-${i * segmentAngle + 22.5}deg); font-weight: bold; color: white; font-size: 14px;`;
                
                // Creating a simpler visual wheel using conical gradient is often better, 
                // but for this DOM method, we just append text absolutely positioned on top of the container.
            });
            
            // Simplified rendering: Just background gradient
            let gradient = `conic-gradient(`;
            spinRewards.forEach((r, i) => {
                gradient += `${spinColors[i]} ${i * segmentAngle}deg ${(i+1) * segmentAngle}deg,`;
            });
            gradient = gradient.slice(0, -1) + ')';
            wheel.style.background = gradient;
        }

        window.spinWheel = async () => {
            if(spinning) return;
            if(dbUser.banned) return showToast('error', '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶ü‡ßá‡¶°');

            const today = new Date().toDateString();
            let counts = dbUser.adCounts || {};
            if(counts.date !== today) counts = {spin: 0, date: today};
            
            if((counts.spin || 0) >= (settings.spinDailyLimit || 10)) {
                return showToast('warning', '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑!');
            }

            spinning = true;
            document.getElementById('spin-btn').disabled = true;

            const segmentAngle = 360 / spinRewards.length;
            // Ensure random ends in middle of a segment
            const randomIndex = Math.floor(Math.random() * spinRewards.length); 
            const reward = spinRewards[randomIndex];
            
            // Calculate rotation: 
            // Index 0 is at top (0 deg). To select index i, we rotate counter-clockwise or 
            // calculating (360 - (i * segmentAngle)). 
            // Adding extra spins (360 * 5)
            const extraSpins = 360 * 6;
            const targetRotation = extraSpins + (360 - (randomIndex * segmentAngle)) - (segmentAngle/2); 

            const wheel = document.getElementById('wheel');
            wheel.style.transform = `rotate(${targetRotation}deg)`;

            setTimeout(async () => {
                spinning = false;
                document.getElementById('spin-btn').disabled = false;
                wheel.style.transition = 'none';
                wheel.style.transform = `rotate(${360 - (randomIndex * segmentAngle) - (segmentAngle/2)}deg)`;
                setTimeout(() => wheel.style.transition = 'transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)', 50);

                if(reward > 0) {
                    await updateDoc(doc(db, "users", dbUser.id.toString()), {
                        balance: increment(reward),
                        totalIncome: increment(reward),
                        "adCounts.spin": increment(1),
                        "adCounts.date": today
                    });
                    Swal.fire({
                        icon: 'success', title: '‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!', text: `‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶® ${reward} ‡¶ï‡ßü‡ßá‡¶®!`,
                        background: '#1e293b', color: '#fff', confirmButtonColor: '#10b981'
                    });
                } else {
                    await updateDoc(doc(db, "users", dbUser.id.toString()), {
                        "adCounts.spin": increment(1), "adCounts.date": today
                    });
                    showToast('info', 'Better luck next time!');
                }
            }, 4000);
        };

        // --- LEADERBOARD ---
        window.openLeaderboard = async () => {
            const modal = document.getElementById('leaderboard-modal');
            const list = document.getElementById('leaderboard-list');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            list.innerHTML = '<div class="text-center text-slate-500 mt-10"><i class="fas fa-spinner fa-spin"></i> ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>';

            try {
                // Requires Firestore Index on 'balance' desc
                const q = query(collection(db, "users"), orderBy("totalIncome", "desc"), limit(10));
                const snap = await getDoc(doc(db, "settings", "leaderboard_cache")); // Optional optimization
                // Direct Query
                onSnapshot(q, (querySnapshot) => {
                    list.innerHTML = "";
                    let rank = 1;
                    querySnapshot.forEach((doc) => {
                        const u = doc.data();
                        const isMe = u.id == currentUser.id ? "bg-blue-900/30 border-blue-500/50" : "bg-slate-800/50 border-slate-700/50";
                        const trophy = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : `#${rank}`;
                        
                        list.innerHTML += `
                            <div class="rank-item flex items-center justify-between p-3 rounded-xl border ${isMe}">
                                <div class="flex items-center gap-3">
                                    <div class="rank-num w-8 font-bold text-lg text-center">${trophy}</div>
                                    <div class="w-8 h-8 rounded-full bg-slate-700 overflow-hidden">
                                        <img src="https://ui-avatars.com/api/?name=${u.firstName}&background=random" class="w-full h-full">
                                    </div>
                                    <div>
                                        <div class="text-xs font-bold text-slate-200">${u.firstName}</div>
                                        <div class="text-[9px] text-slate-500">UID: ${u.id.toString().slice(0,4)}..</div>
                                    </div>
                                </div>
                                <div class="text-xs font-bold text-yellow-500">‡ß≥ ${u.totalIncome.toFixed(0)}</div>
                            </div>
                        `;
                        rank++;
                    });
                });
            } catch (e) {
                list.innerHTML = `<p class="text-red-400 text-center text-xs">Error loading. Index missing?</p>`;
                console.error(e);
            }
        }
        
        window.closeLeaderboard = () => {
            document.getElementById('leaderboard-modal').classList.add('hidden');
        }

        // --- WALLET TABS ---
        window.showWalletTab = (tab) => {
            document.getElementById('wallet-withdraw-view').classList.add('hidden');
            document.getElementById('wallet-history-view').classList.add('hidden');
            document.getElementById('tab-withdraw').className = "flex-1 py-2 rounded-lg text-xs font-bold text-slate-400 hover:text-white transition";
            document.getElementById('tab-history').className = "flex-1 py-2 rounded-lg text-xs font-bold text-slate-400 hover:text-white transition";
            
            if(tab === 'withdraw') {
                document.getElementById('wallet-withdraw-view').classList.remove('hidden');
                document.getElementById('tab-withdraw').className = "flex-1 py-2 rounded-lg text-xs font-bold text-white bg-slate-700 shadow transition";
            } else {
                document.getElementById('wallet-history-view').classList.remove('hidden');
                document.getElementById('tab-history').className = "flex-1 py-2 rounded-lg text-xs font-bold text-white bg-slate-700 shadow transition";
                loadHistory();
            }
        }

        function loadHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '<p class="text-center text-slate-500 text-xs mt-4">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            
            const q = query(collection(db, "withdrawals"), where("userId", "==", dbUser.id.toString()), orderBy("date", "desc"), limit(20));
            onSnapshot(q, (snap) => {
                if(snap.empty) {
                    list.innerHTML = '<p class="text-center text-slate-500 text-xs mt-4">‡¶ï‡ßã‡¶®‡ßã ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶®‡ßá‡¶á</p>';
                    return;
                }
                list.innerHTML = "";
                snap.forEach(d => {
                    const t = d.data();
                    const statusColor = t.status === 'pending' ? 'text-yellow-400' : t.status === 'paid' ? 'text-green-400' : 'text-red-400';
                    const date = t.date ? t.date.toDate().toLocaleDateString() : '';
                    list.innerHTML += `
                        <div class="glass-panel p-3 flex justify-between items-center">
                            <div>
                                <div class="text-xs font-bold text-white">${t.method} - ${t.number}</div>
                                <div class="text-[10px] text-slate-400">${date}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-bold text-white">‡ß≥ ${t.amount}</div>
                                <div class="text-[10px] font-bold uppercase ${statusColor}">${t.status}</div>
                            </div>
                        </div>
                    `;
                });
            });
        }

        // --- ADS & TASKS CORE ---
        function loadMonetagScript(zoneId) {
            if(document.getElementById('monetag-script')) return;
            const s = document.createElement('script');
            s.id = 'monetag-script';
            s.src = '//libtl.com/sdk.js'; 
            s.dataset.zone = zoneId;
            s.dataset.sdk = 'show_' + zoneId; 
            document.body.appendChild(s);
        }

        window.watchAd = async (netId) => {
            if(dbUser.banned) return showToast('error', '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶ü‡ßá‡¶°');
            
            const today = new Date().toDateString();
            let counts = dbUser.adCounts || {};
            if(counts.date !== today) counts = { net1: 0, net2: 0, date: today };

            const limit = adSettings[netId]?.limit || 5;
            const reward = adSettings[netId]?.reward || 10;

            if((counts[netId] || 0) >= limit) return showToast('warning', '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑!');

            const functionName = `show_${settings.monetagZoneId}`; 
            if (typeof window[functionName] === 'function') {
                const startTime = Date.now();
                Swal.fire({
                    title: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...',
                    didOpen: () => Swal.showLoading(),
                    background: '#1e293b', color: '#fff', showConfirmButton: false
                });

                window[functionName]().then(async () => {
                    Swal.close();
                    if ((Date.now() - startTime) / 1000 < 10) {
                        handleStrike();
                    } else {
                        const updateData = {
                            [`adCounts.${netId}`]: increment(1),
                            "adCounts.date": today,
                            balance: increment(reward),
                            totalIncome: increment(reward),
                            adsWatched: increment(1)
                        };
                        await updateDoc(doc(db, "users", dbUser.id.toString()), updateData);
                        Swal.fire({icon:'success', title: `+${reward} Coins Added!`, background: '#1e293b', color: '#fff'});
                    }
                }).catch(e => {
                    Swal.close();
                    showToast('error', '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                });
            } else {
                showToast('error', 'Ad Config Error (Check Internet)');
            }
        }

        function loadTasks() {
            onSnapshot(collection(db, "tasks"), (snap) => {
                const list = document.getElementById('task-list-container');
                list.innerHTML = "";
                if(snap.empty) {
                    list.innerHTML = '<p class="text-center text-xs text-slate-500">‡¶Ü‡¶™‡¶æ‡¶§‡¶§ ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶®‡ßá‡¶á</p>';
                    return;
                }
                snap.forEach(d => {
                    const t = d.data();
                    list.innerHTML += `
                        <div class="glass-panel p-3 flex justify-between items-center" onclick="window.Telegram.WebApp.openLink('${t.link}')">
                            <div class="flex items-center gap-3">
                                <div class="bg-indigo-900/50 p-2 rounded-lg text-indigo-400"><i class="fas fa-link"></i></div>
                                <div><h4 class="font-bold text-sm text-slate-200">${t.title}</h4></div>
                            </div>
                            <div class="bg-slate-700 px-3 py-1 rounded-full text-[10px] text-white">Visit</div>
                        </div>
                    `;
                });
            });
        }

        // --- UTILS ---
        function renderPaymentMethods() {
            const container = document.getElementById('payment-methods-grid');
            container.innerHTML = '';
            const methods = settings.paymentMethods || [
                { id: 'bkash', name: 'bKash', icon: 'https://freelogopng.com/images/all_img/1656235199bkash-logo-transparent.png' },
                { id: 'nagad', name: 'Nagad', icon: 'https://freelogopng.com/images/all_img/1679248828nagad-logo-png.png' }
            ];
            methods.forEach(m => {
                const div = document.createElement('div');
                div.className = 'glass-panel p-4 flex flex-col items-center justify-center cursor-pointer transition h-20 border border-transparent hover:border-blue-500/50';
                div.onclick = () => {
                    selectedPayMethod = m.name;
                    document.querySelectorAll('#payment-methods-grid > div').forEach(x => x.classList.remove('border-blue-500', 'bg-blue-500/10'));
                    div.classList.add('border-blue-500', 'bg-blue-500/10');
                };
                div.innerHTML = `<img src="${m.icon}" class="h-6 mb-1 object-contain"><span class="text-[10px] font-bold text-slate-300">${m.name}</span>`;
                container.appendChild(div);
            });
        }

        window.requestWithdraw = async () => {
            const num = document.getElementById('wd-number').value;
            const amt = parseInt(document.getElementById('wd-amount').value);
            if(!selectedPayMethod) return showToast('error', '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®');
            if(amt < settings.minWithdraw) return showToast('error', `‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ${settings.minWithdraw}`);
            if(dbUser.balance < amt) return showToast('error', '‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á');

            try {
                await updateDoc(doc(db, "users", dbUser.id.toString()), { 
                    balance: increment(-amt), totalWithdraw: increment(amt) 
                });
                await addDoc(collection(db, "withdrawals"), {
                    userId: dbUser.id.toString(), username: dbUser.firstName,
                    method: selectedPayMethod, number: num, amount: amt,
                    status: 'pending', date: serverTimestamp()
                });
                Swal.fire({icon: 'success', title: '‡¶∏‡¶´‡¶≤!', text: '‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá', background: '#1e293b', color: '#fff'});
                document.getElementById('wd-amount').value = '';
            } catch (e) { console.error(e); }
        }

        window.switchTab = (id) => {
            document.querySelectorAll('.page-section').forEach(e => e.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            const map = { home:0, spin:1, tasks:2, wallet:3, profile:4 };
            document.querySelectorAll('.nav-item')[map[id]].classList.add('active');
            window.scrollTo(0,0);
        }

        function handleSecuritySystem() {
            const overlay = document.getElementById('ban-overlay');
            if (dbUser.banned) overlay.classList.remove('hidden');
            else overlay.classList.add('hidden');
        }

        async function handleStrike() {
            const newStrikes = (dbUser.strikes || 0) + 1;
            let updateData = { strikes: increment(1) };
            if (newStrikes >= 3) updateData.banned = true;
            await updateDoc(doc(db, "users", dbUser.id.toString()), updateData);
            Swal.fire({ icon: 'warning', title: 'Strike!', text: '‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶æ‡¶ü‡¶¨‡ßá‡¶® ‡¶®‡¶æ!', background: '#1e293b', color: '#fff' });
        }

        function checkDailyBonusTimer() {
            if(!dbUser) return;
            const btn = document.getElementById('btn-daily-bonus');
            const box = document.getElementById('bonus-timer-box');
            const next = (dbUser.lastBonusTime || 0) + 86400000;
            const now = Date.now();
            
            if (now < next) {
                btn.classList.add('hidden'); box.classList.remove('hidden');
                const diff = next - now;
                const h = Math.floor((diff/(1000*60*60))%24);
                const m = Math.floor((diff/(1000*60))%60);
                const s = Math.floor((diff/1000)%60);
                document.getElementById('bonus-countdown').innerText = `${h}:${m}:${s}`;
            } else {
                btn.classList.remove('hidden'); box.classList.add('hidden');
            }
        }
        
        window.claimDailyBonus = async () => {
            if(dbUser.banned) return;
            await updateDoc(doc(db, "users", dbUser.id.toString()), { 
                balance: increment(settings.dailyBonus), totalIncome: increment(settings.dailyBonus), lastBonusTime: Date.now()
            });
            showToast('success', '‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∞‡¶ø‡¶∏‡¶ø‡¶≠‡¶°!');
        }

        function showToast(icon, title) {
            Swal.fire({
                toast: true, position: 'top', icon: icon, title: title,
                showConfirmButton: false, timer: 2000, background: '#334155', color: '#fff'
            });
        }
        
        window.copyReferral = () => {
            navigator.clipboard.writeText(document.getElementById('ref-link-text').innerText);
            showToast('success', 'Copied!');
        }
        
        window.shareReferral = () => {
             const url = "https://t.me/share/url?url=" + encodeURIComponent(document.getElementById('ref-link-text').innerText) + "&text=" + encodeURIComponent("Join and earn money!");
             window.Telegram.WebApp.openTelegramLink(url);
        }
        
        window.openSupport = () => window.Telegram.WebApp.openTelegramLink(settings.supportLink);

    </script>
</body>
</html>
